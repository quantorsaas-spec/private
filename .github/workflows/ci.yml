tests:
  runs-on: ubuntu-latest
  needs: build
  
  services:
    postgres:
      image: postgres:16
      env:
        POSTGRES_DB: quantor
        POSTGRES_USER: quantor
        POSTGRES_PASSWORD: quantor
      options: >-
        --health-cmd pg_isready
        --health-interval 10s
        --health-timeout 5s
        --health-retries 5
      ports:
        - 5432:5432
  
  steps:
    - uses: actions/checkout@v4
    
    - name: Set up Java 21
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: "21"
        cache: maven
    
    - name: Run tests
      run: mvn -B -e test
      env:
        SPRING_PROFILES_ACTIVE: test
        QUANTOR_DB_URL: jdbc:postgresql://localhost:5432/quantor
        QUANTOR_DB_USER: quantor
        QUANTOR_DB_PASSWORD: quantor